<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>InternshipSlotChecker</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            line-height: 1.6; 
            background-color: #a7c7e7; 
            color: #333; 
            margin: 0; 
            padding: 0;
        }
        .container { 
            max-width: 800px; 
            margin: auto; 
            padding: 20px; 
            background-color: #ffffff; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 { 
            text-align: center; 
            color: #005f75; 
        }
        .stats-container {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 5px solid #005f75;
        }
        .stat-item {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }
        .stat-value {
            font-weight: bold;
            color: #005f75;
        }
        ul { 
            list-style-type: none; 
            padding-left: 0; 
        }
        li { 
            margin-bottom: 10px; 
            font-size: 1.1em;
            padding: 12px;
            background-color: #f9f9f9;
            border-radius: 4px;
            border-left: 4px solid #005f75;
        }
        .company-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .company-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #555;
        }
        .register-info {
            color: #e67e22;
        }
        .acceptance-info {
            color: #27ae60;
        }
        .footer { 
            text-align: center; 
            margin-top: 20px; 
            font-size: 0.8em; 
            color: #777;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            h1, h2 {
                font-size: 1.5em;
            }
            li {
                font-size: 1em;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.2em;
            }
            li {
                font-size: 0.9em;
                padding: 8px;
            }
            .company-info {
                flex-direction: column;
                gap: 3px;
            }
            .footer {
                font-size: 0.7em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CÁC CÔNG TY CÒN SLOT ĐĂNG KÝ THỰC TẬP (tính theo Acepted, F5 để refresh)</h1>
        <h3>FE refresh time (3p), BE refresh time (30p)</h3>
        <h2 id="timestamp">Đang tải...</h2>
        
        <div class="stats-container" id="stats-container">
            <h3>THỐNG KÊ TỶ LỆ CHẤP NHẬN</h3>
            <div class="stat-item">
                <span>Tổng số công ty:</span>
                <span class="stat-value" id="total-companies">--</span>
            </div>
            <div class="stat-item">
                <span>Số công ty hợp lệ:</span>
                <span class="stat-value" id="valid-companies">--</span>
            </div>
            <div class="stat-item">
                <span>Tổng SV được chấp nhận:</span>
                <span class="stat-value" id="total-accepted">--</span>
            </div>
            <div class="stat-item">
                <span>Tổng chỉ tiêu tối đa:</span>
                <span class="stat-value" id="total-max">--</span>
            </div>
            <div class="stat-item" style="margin-top: 15px; padding-top: 10px; border-top: 1px dashed #ccc;">
                <span><strong>Tỷ lệ chấp nhận:</strong></span>
                <span class="stat-value" id="acceptance-ratio" style="color: #e74c3c; font-size: 1.2em;">--</span>
            </div>
        </div>
        
        <h3>DANH SÁCH CÔNG TY CÒN SLOT</h3>
        <ul id="company-list">
            <li>Đang tải danh sách công ty...</li>
        </ul>
        <div class="footer">Generated by Geawn | Cập nhật tự động mỗi 1 tiếng (thôi f5 đi chứ nhiều ae quên tắt tab tốn tài nguyên server)</div>
    </div>

    <script>
        async function loadData() {
            try {
                let data;
                const cachedData = localStorage.getItem('companiesData');
                const cachedTime = localStorage.getItem('companiesLastFetch');
                const now = new Date().getTime();

                if (cachedData && cachedTime) {
                    const timeDiff = (now - parseInt(cachedTime)) / (1000 * 60 * 60);
                    if (timeDiff < 5) {
                        data = JSON.parse(cachedData);
                    }
                }

                if (!data) {
                    const response = await fetch('localhost');
                    data = await response.json();
                    
                    localStorage.setItem('companiesData', JSON.stringify(data));
                    localStorage.setItem('companiesLastFetch', now.toString());
                }

                if (data.acceptanceStats) {
                    document.getElementById('total-companies').textContent = data.acceptanceStats.totalCompanies;
                    document.getElementById('valid-companies').textContent = data.acceptanceStats.validCompanyCount;
                    document.getElementById('total-accepted').textContent = data.acceptanceStats.totalStudentAccepted;
                    document.getElementById('total-max').textContent = data.acceptanceStats.totalMaxAcceptedStudent;
                    document.getElementById('acceptance-ratio').textContent = 
                        data.acceptanceStats.acceptancePercentage + ' (' + data.acceptanceStats.acceptanceRatio + ')';
                }

                const list = document.getElementById('company-list');
                const timestamp = document.getElementById('timestamp');
                list.innerHTML = '';

                if (!data.availableCompanies || data.availableCompanies.length === 0) {
                    list.innerHTML = '<li>Hiện không có công ty nào còn slot đăng ký.</li>';
                } else {
                    data.availableCompanies.forEach((company, index) => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <div class="company-name">${index + 1}. ${company.fullname} (${company.shortname})</div>
                            <div class="company-info">
                                <span class="register-info">Đăng ký: ${company.registerInfo}</span>
                                <span class="acceptance-info">Chấp nhận: ${company.acceptanceInfo}</span>
                            </div>
                        `;
                        list.appendChild(li);
                    });
                }

                timestamp.textContent = 'Thời gian kiểm tra: ' + new Date().toLocaleString();
            } catch (error) {
                document.getElementById('company-list').innerHTML = '<li>Lỗi khi tải dữ liệu.</li>';
                document.getElementById('stats-container').innerHTML = '<p>Không thể tải thống kê</p>';
            }
        }

        loadData();
        setInterval(loadData, 3600000);  // set refresh time
    </script>
</body>
</html>
